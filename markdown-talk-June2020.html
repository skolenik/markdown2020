<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Reproducible report generation using Markdown</title>
    <meta charset="utf-8" />
    <meta name="author" content="Stas Kolenikov" />
    <meta name="date" content="2020-06-29" />
    <link href="libs/font-awesome-5.3.1/css/all.min.css" rel="stylesheet" />
    <link href="libs/font-awesome-5.3.1/css/v4-shims.min.css" rel="stylesheet" />
    <link href="libs/countdown-0.3.3/countdown.css" rel="stylesheet" />
    <script src="libs/countdown-0.3.3/countdown.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet" />
    <script src="libs/tabwid-1.0.0/tabwid.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Reproducible report generation using Markdown
### Stas Kolenikov
### June 29, 2020

---






## Purposes

1. Introduce Markdown as a bare bones text-only format that allows formatting text,
   inserting links, inserting images.
2. Introduce RMarkdown as a tool to weave together text and analysis (tables, figures,
   plots, individual numbers).
3. Demonstrate other uses of Markdown (Stata, Python notebooks, diagrams).
4. Demonstrate flexible / reproducible report generation with parametric Markdown templates
   and input parameters.
5. Provide resources for further professional development.

Helpful upfront knowledge: some R; some HTML

???

I would like to thank AAPOR for giving me the opportunity to present this work.
This presentation is basically about research tools. While my title at Abt
is that of a statistician, there won't be any statistics, just some concepts
of reproducibility, and tools implementing these concepts.

This is a continuing education event, so let us set some minimal educational goals.
Active teaching goal: you would be able to produce basic Markdown documents;
passive goal: you would be able to understand Markdown syntax.

Need R because the best available vehicle is RStudio / RMarkdown. 
Markdown also works in Stata, and is integral to Python Jupyter notebooks.

Need HTML because the primary, and the most flexible and cute looking, output from
Markdown is into HTML.

---

## Focus on reproducibility

Do, redo, and do over again:

- Produce reports for several waves of data.
- Produce reports for the data that is being collected / cleaned.
- Produce updated analyses / updated text for academic papers revisions.

Modern take: [literate programming](https://en.wikipedia.org/wiki/Literate_programming) 
tools based on plain text
- Markdown to code and to write up,
- GitHub to store versions of the code and the writeup, plus optionally the data.

Adopt sensible file storage structures, code documentation practices.

Avoid point and click; avoid copy and paste.

???

Reproducibility needs are all around us, whether we are in industry or in academia.
In my 20+ years of doing statistics, it has never been the case that the first analysis
I ran was the one ultimately reported / published / presented. Expect the work to be
repeated and redone, which means the code to analyzze the data and 
the narrative to explain your results need to be stored and recycled.
In my world of contract research, this typically involves updates to the data
with new methodology reports. In the academic world, this more often involves
a different analysis, e.g. in response to the adviser or the referee comments.

---

## Literate programming

&gt; Let us change our traditional attitude to the construction of programs: 
&gt; Instead of imagining that our main task is to instruct a computer what to do, 
&gt; let us concentrate rather on explaining to humans what we want the computer to do.
&gt; 
&gt; â€” Donald E. Knuth, Literate Programming, 1984

???

The more computationally savvy researchers gravitate towards the tools of 
literate programming, a concept that actually dates back to 1970s when 
Donald Knuth first wrote TeX mathematical typesetting package 
as an example of a literate programming language.
In literate programming, a computer program is given an explanation of its logic 
in a natural language, such as English, interspersed with snippets of macros 
and traditional source code, from which executable code can be generated.
His multivolume book "The Art of Computer Programming" is a fundamental reading in CS. 

---

## Copy-paste vs. markdown

![](docs/copy-paste.jfif)

???

So if I need to copy and paste 10 tables and 5 graphs and 20 individual
numbers for R or Stata into MS Word, I have at least 35 chances to make a mistake.
The likelihood of a mistake, in my opinion, grows much higher when you are 
need to update something, more than just writing from the scratch the first time.
The biggest danger is that you simply forget to update stuff 
in all appropriate places. 

Bottomline: avoid copy-paste if you can. I try to, as hard as I can.

Wouldn't it be great if computer had to remember all of these things,
rather than my old tired brain??

---

## KFF tracking poll

Case study:
Kaiser Family Foundation Kaiser Health Tracking Poll 

[Simplified KFF report: source](KFF-report.Rmd)

[Simplified KFF report: rendered](KFF-report.html)

[Text, tables and graphs version of KFF: rendered](KFF-report-full-April2019.html)

#### Data sources:

March 2019: https://ropercenter.cornell.edu/ipoll/study/31116193,
doi:10.25940/ROPER-31116193

April 2019: https://ropercenter.cornell.edu/ipoll/study/31116357,
doi:10.25940/ROPER-31116357

???

The running example that I hope would be close to the hearts
of AAPORites is a mini-methods report for the KFF tracking poll.
I reproduced the margins of error table and a couple of plots
from the actual report. These are used by permission from KFF.

---

## Extended examples

Books in markdown: http://bookdown.org, https://r4ds.had.co.nz/

Flexible parametric documents in markdown:

https://medium.com/@urban_institute/iterated-fact-sheets-with-r-markdown-d685eb4eafce
(GitHub: https://github.com/UI-Research/rmarkdown-fact-pages)

Dashboards in markdown:

https://rmarkdown.rstudio.com/flexdashboard/examples.html

Diagrams: [Typora diagrams](http://support.typora.io/Draw-Diagrams-With-Markdown/)

Markdowns with several languages: [ICHPS 2020 Complex Surveys](
https://htmlpreview.github.io/?https://github.com/skolenik/ICHPS2020-svy/blob/master/ichps2020-svy.html)

Browser presentations: this webinar (Stas can show 
[the source code](markdown-talk-June2020.Rmd))

---

class: inverse, center

# Basics of Markdown

---

## Markdown

When you make your text **bold**, or _italic_, or `paste(code, snippets)`, or create

- items in lists
- and more items
    * some of which may be nested

you are _marking_ certain elements of your text to be formated in a special way.
(The heading above is also a marked text.)

Markdown modifies this to a very bare bones, text-only, no-mouse-selection-needed process.
The name is supposed to be a play on "markup" which is a technical term to describe
languages like HTML, XML, or LaTeX.

https://daringfireball.net/projects/markdown/syntax

???

Most of the functionality of _basic_ markdown is here on this slide.
This also comprises 98% of what you do in Word: write some text,
declare headings, make lists. Computer scientists decided to abstract these tasks
and make them possible with plain text; they love plain text because
it is very easy to compare text files, and there are very powerful
text editors (I have cycled through WinEdt, UltraEdit, Textpad, Sublime,
Notepad++, and some others; BBEdit is a popular Mac editor. )

---

## Markdown elements

```

Pieces of `code`

Text in _italics_

Text in **bold**

### Heading 3

- unnumbered item
    + nested list item

1. numbered item

[text of a link](http://some.url.com/with/path)

![](some_meme_file.jpg)

```

???

And here is how you "code" those elements in markdown.

As a matter of fact, this is gently supported in Outlook: if you enclose
some text in underscores or stars, it becomes italic or bold.

---

## Exercise

1. Go to [SlackEdit.io](https://stackedit.io/app#) online editor.
2. Open/create a new file (click <i class="fa fa-folder"></i> to open the file menu).
3. Enter the following in the editor with formatting, watch the rendered version in the right pane:

# My first markdown file

Hi, I am **Stas** _Kolenikov_. I use Markdown to:

- create simple documents
    + take notes
    + make to-do lists

<div class="countdown" id="timer_5ef10b62" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

???

OK now I want everybody to take a few minutes and try this at home
on your own computer. Please go to SlackEdit.io (SlackEdit is a very decent
online markdown editor and viewer), and type up a markdown file 
that would have a Header 1 title, your name is bold, your last name 
in italics, and a short list of bulleted items.

---

## Solution

```
# My first markdown file

Hi, I am **FirstName** _LastName_. I am using Markdown to:

- create simple documents
    + take notes
    + make to-do lists
```

Feel free to carry on and do more of the basic markdown tutorials at https://www.markdowntutorial.com/.

---

class: inverse

# Markdown + code

---

## R Markdown

Additionally, combination of Markdown with R and some other languages allows to

- incorporate source code 
- incorporate the output, such as numbers, tables, and plots

... into data-driven documents. 
(You are explaining to other humans, including your future self,
what you want to do with the data!)

Code chunks:

```` 
```r

# some code here

``` 
````

Inline code:

The total number of observatsions is 
&lt;code&gt;&amp;#96;&lt;/code&gt;`r nrow(mydata)`
&lt;code&gt;&amp;#96;&lt;/code&gt;.

???

Well the greater power of markdown comes from the interfaces of markdown
with programming languages. For the most part, I will talk about
interfaces with R, because they are the most extensively developed ones,
but I will also mention other environments, including Stata and Python.

Code chunks: three backticks, output incorporated into the document.

Inline code: usually a single number.

---

## From source to the report

Your source markdown file contains 

- your text describing the data, the analysis, and possibly the findings;
- the code to deal with the data.

How do you get the numbers into the document? How do you know the code actually runs?

Compilation stage: instruct your software to...

- run the underlying code;
- insert the numbers into output;
- present this in a human-readable form (HTML, Word, PDF, PPT, ...)

&lt;img src="data:image/png;base64,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" width="20" height="18" class="GD15MCFCPU"&gt; Knit button in RStudio

???

How exactly does this magic of putting statistical output into text happen? 
What you type is the narrative text and the code; but the code needs to be run.
We can call this step "compilation", or "rendering". 

As I said in the introduction, this presentation is focused on R, 
and the environment way preferred to anything else these days is RStudio.
In RStudio, it is the "Knit" button.

---

## Almost everything you need to know

https://www.rstudio.com/resources/cheatsheets/

Markdown: https://github.com/rstudio/cheatsheets/raw/master/rmarkdown-2.0.pdf

???

RStudio provides a number of great self-learning resources,
including a series of several dozen cheatsheets covering the different
aspects of R, RStudio, and specific packages. One of the cheatsheets
is on Markdown. I believe I know about 25% of this cheatsheet;
and I think in my 3-4 years of using markdown for everything,
there were about two occasions where I had to go beyond the cheatsheet 
and refer to the full documentation to tweak what I needed to be done.

---

## Graphics

![](markdown-talk-June2020_files/figure-html/unnamed-chunk-1-1.png)&lt;!-- --&gt;

```
library(ggplot2)
```

and a myriad of extentions to it. Graphic output of a chunk is inserted.

???

This is a graph from the fake KFF report that I produced.
Basically, this is to say, whatever graphs R can produce,
can be inserted into markdown document.

---

## Tables

&lt;table class="table table-striped table-hover table-condensed" style="margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Group &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; N (unweighted) &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; MOE &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Democrats &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 342 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; +/- 6.2 percentage points &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Republicans &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 273 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; +/- 6.9 percentage points &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Independents &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 544 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; +/- 4.9 percentage points &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Dem-leaning Indeps &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 199 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; +/- 8.3 percentage points &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Rep-leaning Indeps &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 181 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; +/- 8.4 percentage points &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

A lot of output looks like a table already: regression results, cross-tabs.
Other research results may be assembled as small data sets of summary statistics.

```
# aimed at HTML
library(kableExtra)
library(gt)
# aimed more at MS products
library(flextable)
```

---

## library(kableExtra)

Compared to others, produces much nicer tables in HTML, but MS Word breaks down.

&lt;table class="table table-striped table-hover table-condensed" style="margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;color: white !important;background-color: #48A9C5 !important;"&gt; Group &lt;/th&gt;
   &lt;th style="text-align:left;color: white !important;background-color: #48A9C5 !important;"&gt; N (unweighted) &lt;/th&gt;
   &lt;th style="text-align:left;color: white !important;background-color: #48A9C5 !important;"&gt; MOE &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Total &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     text-align: c;font-size: 20px;"&gt;1,203&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; +/- 3.3 percentage points &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;text-align: center;background-color: #3e4040 !important;"&gt; Party ID &lt;/td&gt;
   &lt;td style="text-align:left;text-align: center;background-color: #3e4040 !important;"&gt; &lt;span style="     text-align: c;font-size: 12px;"&gt;&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;text-align: center;background-color: #3e4040 !important;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Democrats &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     text-align: c;font-size: 11px;"&gt;  342&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; +/- 6.2 percentage points &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #3e4040 !important;"&gt; Republicans &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #3e4040 !important;"&gt; &lt;span style="     text-align: c;font-size: 10px;"&gt;  273&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #3e4040 !important;"&gt; +/- 6.9 percentage points &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Independents &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     text-align: c;font-size: 13px;"&gt;  544&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; +/- 4.9 percentage points &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #3e4040 !important;"&gt; Dem-leaning Indeps &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #3e4040 !important;"&gt; &lt;span style="     text-align: c;font-size: 8px;"&gt;  199&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #3e4040 !important;"&gt; +/- 8.3 percentage points &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Rep-leaning Indeps &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &lt;span style="     text-align: c;font-size: 8px;"&gt;  181&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; +/- 8.4 percentage points &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

[Documentation vignette 
here.](https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html)

---

## library(kableExtra)

Compared to others, produces much nicer tables in HTML, but MS Word breaks down.

````
```r MOE_kableExtra
readRDS(here('KFF_MOE.Rds')) %&gt;% 
  mutate(`N (unweighted)` = cell_spec(`N (unweighted)`, "html", 
            font_size = spec_font_size(sqrt(neff), end=20),
            align = 'c') ) %&gt;% # fancy sample size
  select(Group, `N (unweighted)`,MOE) %&gt;%  
  kable(escape=FALSE) %&gt;% 
  row_spec(0,color='white',background="#48A9C5") %&gt;%  # header colors
  row_spec(2,align="center") %&gt;%                      # center Party ID
  row_spec(c(2,4,6), background = '#3e4040') %&gt;%      # alternate rows 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))
```
````

---

## library(flextable)

Compared to others, produces reasonably nice table in both HTML and MS Word.

<div class="tabwid"><table style='border-collapse:collapse;width:357px;'><thead><tr style="overflow-wrap:break-word;"><td style="width:119px;background-clip: padding-box;background-color:rgba(72, 169, 197, 1.00);vertical-align: middle;border-bottom: 2.00px solid rgba(0, 0, 0, 1.00);border-top: 2.00px solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;"><p style="margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;background-color:transparent;"><span style="font-family:'Arial';font-size:11px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(255, 255, 255, 1.00);background-color:transparent;">Group</span></p></td><td style="width:95px;background-clip: padding-box;background-color:rgba(72, 169, 197, 1.00);vertical-align: middle;border-bottom: 2.00px solid rgba(0, 0, 0, 1.00);border-top: 2.00px solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;"><p style="margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;background-color:transparent;"><span style="font-family:'Arial';font-size:11px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(255, 255, 255, 1.00);background-color:transparent;">N (unweighted)</span></p></td><td style="width:143px;background-clip: padding-box;background-color:rgba(72, 169, 197, 1.00);vertical-align: middle;border-bottom: 2.00px solid rgba(0, 0, 0, 1.00);border-top: 2.00px solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;"><p style="margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;background-color:transparent;"><span style="font-family:'Arial';font-size:11px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(255, 255, 255, 1.00);background-color:transparent;">MOE</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td style="width:119px;background-clip: padding-box;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;"><p style="margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;background-color:transparent;"><span style="font-family:'Arial';font-size:11px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(17, 17, 17, 1.00);background-color:transparent;">Total</span></p></td><td style="width:95px;background-clip: padding-box;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;"><p style="margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;background-color:transparent;"><span style="font-family:'Arial';font-size:11px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(17, 17, 17, 1.00);background-color:transparent;">1,203</span></p></td><td style="width:143px;background-clip: padding-box;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;"><p style="margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;background-color:transparent;"><span style="font-family:'Arial';font-size:11px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(17, 17, 17, 1.00);background-color:transparent;">+/- 3.3 percentage points</span></p></td></tr><tr style="overflow-wrap:break-word;"><td style="width:119px;background-clip: padding-box;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;"><p style="margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;background-color:transparent;"><span style="font-family:'Arial';font-size:11px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(17, 17, 17, 1.00);background-color:transparent;">Party ID</span></p></td><td style="width:95px;background-clip: padding-box;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;"><p style="margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;background-color:transparent;"><span style="font-family:'Arial';font-size:11px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(17, 17, 17, 1.00);background-color:transparent;"></span></p></td><td style="width:143px;background-clip: padding-box;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;"><p style="margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;background-color:transparent;"><span style="font-family:'Arial';font-size:11px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(17, 17, 17, 1.00);background-color:transparent;"></span></p></td></tr><tr style="overflow-wrap:break-word;"><td style="width:119px;background-clip: padding-box;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;"><p style="margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;background-color:transparent;"><span style="font-family:'Arial';font-size:11px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(17, 17, 17, 1.00);background-color:transparent;">Democrats</span></p></td><td style="width:95px;background-clip: padding-box;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;"><p style="margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;background-color:transparent;"><span style="font-family:'Arial';font-size:11px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(17, 17, 17, 1.00);background-color:transparent;">  342</span></p></td><td style="width:143px;background-clip: padding-box;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;"><p style="margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;background-color:transparent;"><span style="font-family:'Arial';font-size:11px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(17, 17, 17, 1.00);background-color:transparent;">+/- 6.2 percentage points</span></p></td></tr><tr style="overflow-wrap:break-word;"><td style="width:119px;background-clip: padding-box;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;"><p style="margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;background-color:transparent;"><span style="font-family:'Arial';font-size:11px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(17, 17, 17, 1.00);background-color:transparent;">Republicans</span></p></td><td style="width:95px;background-clip: padding-box;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;"><p style="margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;background-color:transparent;"><span style="font-family:'Arial';font-size:11px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(17, 17, 17, 1.00);background-color:transparent;">  273</span></p></td><td style="width:143px;background-clip: padding-box;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;"><p style="margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;background-color:transparent;"><span style="font-family:'Arial';font-size:11px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(17, 17, 17, 1.00);background-color:transparent;">+/- 6.9 percentage points</span></p></td></tr><tr style="overflow-wrap:break-word;"><td style="width:119px;background-clip: padding-box;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;"><p style="margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;background-color:transparent;"><span style="font-family:'Arial';font-size:11px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(17, 17, 17, 1.00);background-color:transparent;">Independents</span></p></td><td style="width:95px;background-clip: padding-box;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;"><p style="margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;background-color:transparent;"><span style="font-family:'Arial';font-size:11px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(17, 17, 17, 1.00);background-color:transparent;">  544</span></p></td><td style="width:143px;background-clip: padding-box;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;"><p style="margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;background-color:transparent;"><span style="font-family:'Arial';font-size:11px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(17, 17, 17, 1.00);background-color:transparent;">+/- 4.9 percentage points</span></p></td></tr><tr style="overflow-wrap:break-word;"><td style="width:119px;background-clip: padding-box;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;"><p style="margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;background-color:transparent;"><span style="font-family:'Arial';font-size:11px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(17, 17, 17, 1.00);background-color:transparent;">Dem-leaning Indeps</span></p></td><td style="width:95px;background-clip: padding-box;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;"><p style="margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;background-color:transparent;"><span style="font-family:'Arial';font-size:11px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(17, 17, 17, 1.00);background-color:transparent;">  199</span></p></td><td style="width:143px;background-clip: padding-box;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;"><p style="margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;background-color:transparent;"><span style="font-family:'Arial';font-size:11px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(17, 17, 17, 1.00);background-color:transparent;">+/- 8.3 percentage points</span></p></td></tr><tr style="overflow-wrap:break-word;"><td style="width:119px;background-clip: padding-box;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 2.00px solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;"><p style="margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;background-color:transparent;"><span style="font-family:'Arial';font-size:11px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(17, 17, 17, 1.00);background-color:transparent;">Rep-leaning Indeps</span></p></td><td style="width:95px;background-clip: padding-box;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 2.00px solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;"><p style="margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;background-color:transparent;"><span style="font-family:'Arial';font-size:11px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(17, 17, 17, 1.00);background-color:transparent;">  181</span></p></td><td style="width:143px;background-clip: padding-box;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 2.00px solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;"><p style="margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;background-color:transparent;"><span style="font-family:'Arial';font-size:11px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(17, 17, 17, 1.00);background-color:transparent;">+/- 8.4 percentage points</span></p></td></tr></tbody></table></div>

[Overview here](https://davidgohel.github.io/flextable/articles/overview.html)

---

## library(flextable)

````
```r MOE_flextable
readRDS(here('KFF_MOE.Rds')) %&gt;% 
  select(Group, 'N (unweighted)', MOE) %&gt;%  
  flextable() %&gt;%             # convert to flextable
  align(j=1,align="left") %&gt;%         # change alignment for Group
  align(i=2,j=1,align="center") %&gt;%   # put "Party ID" in the center
  bg(bg="#48A9C5", part="header") %&gt;% # header colors
  color(color="white", part="header") %&gt;%
  bg(bg="white", part="body") %&gt;%
  autofit()                           # some magic in column widths
```
````

---

class: inverse

# Customizing markdown output

---

## R chunk options

Chunk options modify how the code runs within the chunk, 
and how the output is being displayed.

```` 
```r ChunkName, echo=FALSE, fig.height=4, fig.width=6

# some graphics code here that I don't care to see in the final output

``` 
````

Review the chunk options in 
[RStudio cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/rmarkdown-2.0.pdf)

---

## Parametric markdown documents

The more advanced forms of markdown documents use inputs/parameters.

- Output format: HTML (the most flexible, and the only interactive), Word, PDF (requires LaTeX)
- Task to perform: analysis vs. reporting the results
- Input data files
- Formatting specifications (e.g. colors to use)

Compilation of parametric markdown documents 
is typically done from command line / R scripts:

```
rmarkdown::render( ..., 
    params=list(todo='analysis',
          input_data='KFF-April2019.sav'))
```

???

I said before that you render the markdown documents by hitting the 
"Knit" button in RStudio. Of course all that this button does is 
runs a certain R function. That function is `rmarkdown::render()`.
If I wanted to do something custom, I would need to run this explicitly,
either from the console or in a script.

---

## Parametric markdown: output

```
filename_stub &lt;- 'MyReport'
rmarkdown::render(
  input=paste0(filename_stub,.'Rmd'), 
         # input file
  output_file=I(paste0(filename_stub,'-',Sys.Date())),  
         # output file with date embedded, no extension
  output_format='docx_document')                        
         # output format; the extension is inferred from it
  # output_format='html_document')                      
         # alternative output format; here, commented out
)  
```

PDF output requires a LaTeX compiler; not presented in this talk.

???

One easy degree of flexibility is that of output format:
say HTML vs. MS Word. Rendering into one or the other 
can be handled by the named options of the `render()` function.


---

## Parametric markdown: YAML header

```
---
title: "Reproducible report generation using Markdown"
author: "Stas Kolenikov"
date: 2020-06-22
output:
  html_output:
    code_folding: hide
    toc: TRUE
  word_document:
    reference_docx: Abt_2018_Report_Template.docx
---
```

???

The parametric or flexible interfaces of your document are contained
in the YAML header. YAML stands for Yet Another Markup Language.
Most of YAML header is fixed syntax with reserved keywords,
such as `title`, `author`, `date`, `output`, and fixed suboptions of these.
Here, there are different suboptions for the different output formats.

---

## Parametric markdown: YAML header

```
---
title: "Reproducible report genercation using Markdown"
author: "Stas Kolenikov"
date: 2020-06-22
params:
  todo: analysis
  # todo: reporting
  data_source: April2019.dta
  # data_source: Mar2019.dta
  digits: 4
---
```
???

Here's how the list of flexible parameters is to be specified in the YAML header.
You can give them the names you like and find informative of the function.
For instance, if I have analyses that run forever, I can have a `todo` parameter
that instructs my code what to do. If I envision running my analysis with 
different data sources, I can specify the data source as a parameter.


---

## Parametric markdown: tasks to do

````
```r long_analysis
if (params$todo=="analysis") {
  # mixed modeling code that takes hours to execute
  model1 &lt;- ...
  saveRDS(model1, file='model1.Rds')
} else if (params$todo=="reporting") {
  model1 &lt;- readRDS(file='model1.Rds')
}
```
````

---

## Parametric markdown: varying data

Explicit naming:

````

---
params:
  data_source: KFF-April2019.sav
---

```r read_data
main_data &lt;- read.sav( params$data_source )
```

````

???

So one of the very common tasks that markdown documents are ideal for
is re-running your analysis shell with different data sets ---
in my example above, I ran it with two different months of KFF data.
A brute force, soft of, approach to this is to pass the name of the file
into the document via `params$data_source` full name.

---

## Parametric markdown: varying data

Combining parts:

````
---
...
params:
  month: April
---

```r read_data_by_month
main_data &lt;- read.sav( paste0( 'KFF-',params$month, '2019.sav' ) )
```
````

Which can be rendered with

```
filename_stub &lt;- 'MyReport'
month         &lt;- 'April'
rmarkdown::render(input=paste0(filename_stub,.'Rmd'),   # input file
  output_file=I(paste0(filename_stub,'-',month,'-',Sys.Date())),  
  output_format='docx_document'),                       # output format
  params=list(month=month)                              # pass parameters
)
```

??? 

If the file names follow a specific pattern, you can pass the 
variable parts of that pattern instead. This may make more sense
when the name of the output file is being varied in a similar pattern.
Here, I am creating the output file name by combining the stub,
the variable part (month), and I also time stamp it with the date
baked into the file name.

---

## Hands-on: edit the KFF report

Go back to the KFF report markdown file and make it parametric (take month and year as input)

---

class: inverse

# Markdown presentations

---

## Markdown presentations

Several libraries available, with slightly differing functionality (and ease of adjusting options):

- `ioslides` (probably the easiest to run)
    * presenter mode
    * custom CSS
- `slidy`
    * fixed timer per slide
- `shower` 
    * easier to create self-contained presentation HTML files
    * not compatible with `flextable`
- `xaringan` (this presentation)
    * not compatible with `shiny` interactive elements
    * presenter mode

Slides are separated by `---` (separator line) or by `##` (Header 2).

Handouts: print from browser to PDF.

---

## Markdown presentations

[Abt colors:](https://abtassoc.sharepoint.com/departments/Comms/Documents/Abt-Brand-ID-Style-Guide.pdf)

````
style_solarized_dark()
style_xaringan(
  background_color = '#000000',
  text_color       = '#B7C9D3',
  header_color     = '#DA291C',
  title_slide_text_color          = '#DA291C',
  title_slide_background_color    = '#DFD1A7',
  title_slide_background_image    = 'AbtLogo2.png',
  title_slide_background_size	    = '200px 100px',
  title_slide_background_position	= 'bottom 10px left 20px',
  background_image     = 'AbtLogo2.png',
  background_size	     = '90px 45px',
  background_position	 = 'bottom 10px left 10px',
  link_color           = '#7566A0',
  code_inline_color    = '#C3C6A8',
  code_highlight_color = '#E87722'
)
````

---

class: inverse

# A few words about version control

??? 

We have covered the basics of markdown and its interface with R.
Now I wanted to briefly talk about an additional benefit I am finding
in using markdown documents.

---

## Reasons for markdown

1. Combine narrative and data analysis
2. Reproduce your work (reports, revisions)
3. Reuse the code with different options, sources, formatting, ...
4. Version control over the plain text of markdown documents

???

So I mentioned earlier that computer scientists favorite format is
plain text, for the simple reason that comparing text files,
finding differences and updates is easier than say comparing two Excel files
or two PDF files. This line of thinking culminates in the version control
systems that computer scientists and software developers use to 
develop code and isolate changes. Basically it's a way to remember
every significant edit (not necessarily every keystroke, but maybe 
updates of code that change its functionality or behavior in some way.)
For instance, you wrote a new function -- you document that change
and commit it to the memory of the version control system. You found
a bug in your function -- you document that change and commit it.
You fixed the bug -- you document that change and commit it.

---

## Reasons for markdown: version control

![](docs/rainman.jpg)

???

Computers can remember everything. Humans are not supposed to.

---

## Version control

This talk:

- https://github.com/skolenik/markdown2020

A complete introduction to using Git with RStudio

- https://happygitwithr.com/ by @JennyBryan

---

class: inverse

# Markdown and other languages

???

Another extension that I may or may not be able to talk about in full length
is how markdown interfaces with other languages, and what other research
tasks can be implemented with it.

---

## Markdown

![](docs/markdown-everywhere.jpg)

---

## Markdown in other languages

Stata: 

* official Stata markdown `&lt;&lt;dd-syntax&gt;&gt;`
* user-contributed `markstat` (interface to Pandoc markdown) package,
https://data.princeton.edu/stata/markdown

(See Stas' [ICHPS 2020 Complex Surveys](https://github.com/skolenik/ICHPS2020-svy/blob/master/ichps2020-svy.stmd))

---

## Markdown in other languages

Python: markdown cells in notebooks

#### Hands-on part for Stas: launch a notebook to show

---

## Markdown in other languages

Diagrams: `mermaid` in Typora

---

## Sequence diagrams

![](http://support.typora.io/media/diagrams/js-sequence.png)

???

Sequence diagrams are intended to describe (and to some extent formalize)
interactions between process or agents in a system.

---

## Sequence diagrams

````
```sequence
Alice -&gt; Bob:      Hello Bob, how are you?
Note right of Bob: Bob thinks
Bob --&gt; Alice:     I am good thanks!
```
````

Try more at https://mermaid-js.github.io/mermaid-live-editor/

???

So the markdown code is pretty much literal: there are arrows,
there is a description of a note and where it is positioned, and so on.

---

## Sequence diagrams

![](mrp.png)

???

My use of these markdown diagrams grew out of a need to systematize 
the workflow of data in a small area estimation project. I had several
sources of data and about 20 scripts interacting with one another
(and some scripts actually wrote some code to be run automatically,
and ran that code). The project reached a point where I really needed 
to change things in several small places to address clients' comments,
so I ended up spending several hours putting every script in a box,
and explicate what the different scripts and functions were passing to one another.
My diagram ended up being four letter size printouts taped to one another,
I used it a lot for my own reference, and it was very handy to show off
in a methods report, too.

---

## Other languages in RStudio

Python:

````
```r libraries
library(reticulate)
```

Do something in Python:

```python
import pandas as pd
flights = pd.read_csv('flights.csv')
```

Pass back to R:

```r
head( py$flights )
```

````

???

Python and R can easily coexist in RStudio. Some people go as far as to say
that RStudio is a solid Python editor (given that you use Google and online
documentation, anyway, so the relevance of the "Help" window is not huge).

---

## Other languages in RStudio

Stata:

````
```r stata_engine
statapath &lt;- "C:/Program Files/Stata16/Stata-MP.exe"
library(Statamarkdown)
knitr::opts_chunks$set(engine.path=list(stata=statapath))
```
````

Do something in Stata (`collectcode` option makes sure results are cumulative):

````
```stata, collectcode=TRUE
sysuse auto, clear
```
````

More Stata:

````
```stata
scatter mpg price
```
````

---

class: inverse

# In the spirit of reproducible reporting

???

One last point for reproducible reporting: 
it is worthwhile keeping track of what exactly you used to 
produce the results. You, of course, may have the code 
at your fingertips, but anybody who had worked with R 
knows that packages change, R changes, and sometimes stuff
that worked before is broken now.

---

## Software citations

R version: R version 3.6.3 (2020-02-29).

Package versions:



- library(here):  version 0.1
- library(knitr):  version 1.28
- library(kableExtra):  version 1.1.0
- library(flextable):  version 0.5.9
- library(tidyverse):  version 1.3.0
- library(xaringanthemer):  version 0.3.0
- library(shiny):  version 1.4.0
- library(countdown):  version 0.3.3


???

So if you have had the good fortune of being able to run
the code inside your markdown document without errors,
it is advisable to jot down what the libraries and their versions are.

Here is what I used in this presentation, and package versions at the compile time.

---

## Thanks

Stas Kolenikov ([skolenik@gmail.com](skolenik@gmail.com))

Twitter [@StatStas](http://twitter.com/StatStas)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "solarized-dark",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  /* Replace <script> tags in slides area to make them executable
   *
   * Runs after post-processing of markdown source into slides and replaces only
   * <script>s on the last slide of continued slides using the .has-continuation
   * class added by xaringan. Finally, any <script>s in the slides area that
   * aren't executed are commented out.
   */
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container:not(.has-continuation) script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
  var scriptsNotExecuted = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container.has-continuation script'
  );
  if (!scriptsNotExecuted.length) return;
  for (var i = 0; i < scriptsNotExecuted.length; i++) {
    var comment = document.createComment(scriptsNotExecuted[i].outerHTML)
    scriptsNotExecuted[i].parentElement.replaceChild(comment, scriptsNotExecuted[i])
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
